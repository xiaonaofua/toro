# 安全配置指南

## ⚠️ 安全風險說明

將Supabase配置放在GitHub公開倉庫中確實存在一些風險：

### 風險等級：

1. **SUPABASE_URL** - ✅ 安全（可公開）
2. **SUPABASE_ANON_KEY** - ⚠️ 中等風險（需要配置安全策略）

### 潛在風險：

- 惡意用戶可能讀取/修改/刪除所有水燈數據
- API濫用消耗免費額度
- 添加大量垃圾數據

## 🛡️ 安全防護方案

### 方案一：啟用安全策略（推薦）

1. **運行安全SQL腳本**
   - 在Supabase SQL Editor中運行 `secure_policies.sql`
   - 這會啟用行級安全性並設置合理的訪問限制

2. **安全策略效果**：
   - ✅ 允許所有人查看水燈
   - ✅ 限制添加水燈的頻率和內容
   - ✅ 禁止修改和刪除現有水燈
   - ✅ 自動清理過多的舊數據

### 方案二：使用環境變量（更安全）

創建一個配置頁面，讓用戶輸入自己的Supabase配置：

```javascript
// 不在代碼中硬編碼配置
let SUPABASE_URL = localStorage.getItem('supabase_url');
let SUPABASE_ANON_KEY = localStorage.getItem('supabase_key');

if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
    // 顯示配置界面，要求用戶輸入
    showConfigDialog();
}
```

### 方案三：混合模式

- 提供默認的演示配置（用於快速體驗）
- 允許用戶配置自己的Supabase項目（用於正式使用）

## 📊 風險評估

### 對於個人項目：
- **低風險** - 只是水燈數據，不涉及敏感信息
- **中等影響** - 最壞情況是數據被清空，重新初始化即可

### 對於商業項目：
- **高風險** - 需要更嚴格的安全措施
- **推薦使用私有倉庫或後端代理**

## 🎯 推薦做法

### 立即執行（推薦）：
1. 運行 `secure_policies.sql` 啟用安全策略
2. 監控Supabase項目的使用情況
3. 定期檢查數據是否異常

### 長期考慮：
1. 將敏感配置移到服務端
2. 使用私有GitHub倉庫
3. 實施更複雜的身份驗證

## 🔍 監控建議

定期檢查：
1. **Supabase Dashboard** - 查看API使用量
2. **Table Editor** - 檢查是否有異常數據
3. **Logs** - 查看異常的API調用

## 💡 結論

對於這個水燈項目：
- **風險可控** - 不涉及敏感用戶信息
- **影響有限** - 最壞情況是重新初始化數據
- **防護有效** - 通過安全策略可以大幅降低風險

**建議**：先運行安全SQL腳本，然後正常使用。如果發現異常，隨時可以重置項目。