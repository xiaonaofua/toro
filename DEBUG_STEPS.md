# èª¿è©¦æ­¥é©Ÿ - æ°´ç‡ˆæ•¸æ“šä¸ä¿å­˜å•é¡Œ

## ğŸ” **ç¬¬1æ­¥ï¼šæª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°**

1. **æ‰“é–‹ç¶²ç«™ä¸¦æŒ‰F12**
2. **é»æ“ŠConsoleæ¨™ç±¤**
3. **å˜—è©¦æ·»åŠ ä¸€å€‹æ°´ç‡ˆ**
4. **æŸ¥çœ‹æ§åˆ¶å°è¼¸å‡º**

### é æœŸçš„æ­£å¸¸è¼¸å‡ºï¼š
```
âœ… Supabaseå®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
å˜—è©¦æ·»åŠ æ–°æ°´ç‡ˆ: {id: 21, baseX: 300, baseY: 400, message: "æ¸¬è©¦"}
ç™¼é€åˆ°Supabaseçš„æ•¸æ“š: {id: 21, baseX: 300, baseY: 400, message: "æ¸¬è©¦", ...}
âœ… æ–°æ°´ç‡ˆå·²æ·»åŠ åˆ°Supabase: {id: 21, ...}
```

### å¯èƒ½çš„éŒ¯èª¤è¼¸å‡ºï¼š
```
âŒ Supabaseæ’å…¥å¤±æ•—: {message: "permission denied", code: "42501"}
âŒ Supabaseæ“ä½œç•°å¸¸: TypeError: Cannot read property...
âš ï¸ Supabaseæœªå•Ÿç”¨ï¼Œä¿å­˜åˆ°æœ¬åœ°å­˜å„²
```

## ğŸ› ï¸ **ç¬¬2æ­¥ï¼šé‹è¡Œæ¬Šé™ä¿®å¾©SQL**

1. **æ‰“é–‹Supabaseé …ç›®**
2. **é»æ“Šå·¦å´ "SQL Editor"**
3. **é»æ“Š "New query"**
4. **è¤‡è£½ç²˜è²¼ `fix_permissions.sql` çš„å…§å®¹**
5. **é»æ“Š "Run"**

### æª¢æŸ¥çµæœï¼š
- æ¸¬è©¦æ’å…¥æ˜¯å¦æˆåŠŸ
- è¡¨çµæ§‹æ˜¯å¦æ­£ç¢º
- RLSæ˜¯å¦å·²ç¦ç”¨

## ğŸ”§ **ç¬¬3æ­¥ï¼šå¸¸è¦‹å•é¡Œæ’æŸ¥**

### A. RLS (Row Level Security) å•é¡Œ
**ç—‡ç‹€**: æ§åˆ¶å°é¡¯ç¤º "permission denied" æˆ– "insufficient privilege"
**è§£æ±º**: é‹è¡Œ `ALTER TABLE water_lanterns DISABLE ROW LEVEL SECURITY;`

### B. è¡¨çµæ§‹å•é¡Œ  
**ç—‡ç‹€**: æ§åˆ¶å°é¡¯ç¤º "column does not exist" 
**è§£æ±º**: é‡æ–°é‹è¡Œ `create_table.sql` å‰µå»ºæ­£ç¢ºçš„è¡¨çµæ§‹

### C. API Keyæ¬Šé™å•é¡Œ
**ç—‡ç‹€**: æ§åˆ¶å°é¡¯ç¤º "Invalid API key" æˆ– "unauthorized"
**è§£æ±º**: 
1. æª¢æŸ¥ `app.js` ä¸­çš„ `SUPABASE_ANON_KEY` æ˜¯å¦æ­£ç¢º
2. ç¢ºèªä½¿ç”¨çš„æ˜¯ "anon public key" ä¸æ˜¯ "service_role key"

### D. ç¶²çµ¡é€£æ¥å•é¡Œ
**ç—‡ç‹€**: æ§åˆ¶å°é¡¯ç¤º "Failed to fetch" æˆ– "Network error"
**è§£æ±º**: æª¢æŸ¥ç¶²çµ¡é€£æ¥ï¼Œç¢ºèªSupabaseé …ç›®ç‹€æ…‹æ­£å¸¸

### E. æ•¸æ“šé¡å‹å•é¡Œ
**ç—‡ç‹€**: æ§åˆ¶å°é¡¯ç¤º "invalid input syntax" 
**è§£æ±º**: æª¢æŸ¥ç™¼é€çš„æ•¸æ“šé¡å‹æ˜¯å¦åŒ¹é…è¡¨çµæ§‹

## ğŸ“‹ **ç¬¬4æ­¥ï¼šæ‰‹å‹•æ¸¬è©¦**

åœ¨Supabase SQL Editorä¸­ç›´æ¥æ¸¬è©¦ï¼š

```sql
-- 1. æª¢æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
SELECT * FROM water_lanterns LIMIT 1;

-- 2. æ‰‹å‹•æ’å…¥æ¸¬è©¦æ•¸æ“š
INSERT INTO water_lanterns (baseX, baseY, message) 
VALUES (300, 400, 'æ‰‹å‹•æ¸¬è©¦æ°´ç‡ˆ');

-- 3. æŸ¥çœ‹æ˜¯å¦æ’å…¥æˆåŠŸ
SELECT * FROM water_lanterns ORDER BY id DESC LIMIT 3;
```

## ğŸ¯ **ç¬¬5æ­¥ï¼šæ ¹æ“šéŒ¯èª¤ä¿¡æ¯æ¡å–è¡Œå‹•**

| éŒ¯èª¤é¡å‹ | æ§åˆ¶å°ä¿¡æ¯ | è§£æ±ºæ–¹æ¡ˆ |
|----------|------------|----------|
| æ¬Šé™å•é¡Œ | `permission denied` | é‹è¡Œæ¬Šé™ä¿®å¾©SQL |
| è¡¨ä¸å­˜åœ¨ | `relation does not exist` | é‡æ–°å‰µå»ºè¡¨ |
| åˆ—ä¸å­˜åœ¨ | `column does not exist` | æª¢æŸ¥è¡¨çµæ§‹ |
| æ•¸æ“šé¡å‹ | `invalid input syntax` | æª¢æŸ¥æ•¸æ“šæ ¼å¼ |
| ç¶²çµ¡å•é¡Œ | `Failed to fetch` | æª¢æŸ¥é€£æ¥å’ŒAPIé…ç½® |

## ğŸ’¡ **å¿«é€Ÿä¿®å¾©å»ºè­°**

æœ€å¸¸è¦‹çš„å•é¡Œæ˜¯RLSæ¬Šé™ï¼Œå˜—è©¦é€™å€‹å¿«é€Ÿä¿®å¾©ï¼š

```sql
-- åœ¨ Supabase SQL Editor ä¸­é‹è¡Œ
ALTER TABLE water_lanterns DISABLE ROW LEVEL SECURITY;
```

ç„¶å¾Œåˆ·æ–°ç¶²é é‡æ–°æ¸¬è©¦ã€‚

---

**è«‹æŒ‰é †åºåŸ·è¡Œé€™äº›æ­¥é©Ÿï¼Œä¸¦å‘Šè¨´æˆ‘åœ¨å“ªä¸€æ­¥çœ‹åˆ°äº†ä»€éº¼éŒ¯èª¤ä¿¡æ¯ï¼**